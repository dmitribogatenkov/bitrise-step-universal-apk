title: |-
  Universal Apk
summary: |
  Generates an universal apk from an app bundle
description: |
  Runs a bundletool that gets an app bundle path and generates an universal apk that it can be upload to alternative app stores or test platforms.

is_requires_admin_user: true
is_always_run: false
is_skippable: false
run_if: ""

deps:
  brew:
  - name: unzip
  - name: wget
  - name: curl
  apt_get:
  - name: unzip
  - name: wget
  - name: curl


toolkit:
  bash:
    entry_file: step.sh


inputs:
  - aab_path: "$BITRISE_AAB_PATH"
    opts:
      title: "Build artifact path."
      summary: "`Android App Bundle (.aab)`"
      description: |-
        Path(s) to the build artifact file `.aab`. You can build the bundle running `:bundleRelease` gradle task
        Format examples:
        - `/path/to/my/app.aab`
      is_required: true
  - apk_name: "$BITRISE_APK_OUTPUT_NAME"
    opts:
      title: "Universal apk name"
      summary: "`Name of the resulting apk`"
      description: |-
        The name must end with .apk
        Format examples:
        - `apk_name.apk` orÂ `apk_name`
      is_required: false
  - apk_output_dir: "$BITRISE_APK_OUTPUT_DIR"
    opts:
      title: "APK's output directory"
      summary: "`Path where the apk's will be moved after`"
      description: |-
        If no Apk otuput dir is provided, the apk's will be at $BITRISE_APK_DIR
        Format examples:
        - `$BITRISE_DEPLOY_DIR`
      is_required: false
  - keystore_url: $BITRISEIO_ANDROID_KEYSTORE_URL
    opts:
      title: "Keystore url"
      summary: ""
      description: |-
        For remote keystores you can provide any download location (ex: https://URL/TO/keystore.jks).
        For local keystores provide file path url. (ex: file://PATH/TO/keystore.jks).
      is_required: true
      is_sensitive: true
  - keystore_password: $BITRISEIO_ANDROID_KEYSTORE_PASSWORD
    opts:
      title: "Keystore password"
      summary: ""
      description: ""
      is_required: true
      is_sensitive: true
  - keystore_alias: $BITRISEIO_ANDROID_KEYSTORE_ALIAS
    opts:
      title: "Keystore alias"
      summary: ""
      description: ""
      is_required: true
      is_sensitive: true
  - keystore_alias_password: $BITRISEIO_ANDROID_KEYSTORE_ALIAS_PASSWORD
    opts:
      title: "Keystore alias password"
      summary: ""
      description: ""
      is_required: true
      is_sensitive: true

outputs:
  - BITRISE_APK_PATH:
    opts:
      title: "Universal apk path"
      summary: Path to the universal apk signed with the given keystore
      description: |
       You can upload this apk to an alternative app stores or your test platform
  - BITRISE_APK_DIR:
    opts:
      title: "Apk direcotry"
      summary: Path to directory where all the apk's are stored after the step.
      description: |
       You can upload this directory to an alternative app stores or your test platform
